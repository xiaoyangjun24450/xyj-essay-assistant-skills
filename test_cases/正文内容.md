# 绪论

## 1.1 研究背景与意义

随着工业自动化和智能制造的快速发展，电机控制系统在现代工业中扮演着越来越重要的角色。传统的电机控制方法如PWM调速、V/F控制等虽然实现简单，但在控制精度、响应速度和能效方面存在明显不足。磁场定向控制(Field Oriented Control, FOC)作为一种先进的电机控制策略，能够实现对交流电机的精确控制，在高性能伺服系统中得到了广泛应用。

近年来，随着物联网技术的兴起和嵌入式系统的发展，基于微控制器的FOC控制方案成为研究热点。ESP32作为一款集成了Wi-Fi和蓝牙功能的低成本32位微控制器，具有强大的计算能力和丰富的外设接口，为实现智能化的FOC控制器提供了理想的硬件平台。

## 1.2 国内外研究现状

### 1.2.1 国外研究现状

国外在FOC控制技术方面的研究起步较早，已经形成了相对成熟的技术体系。表1-1展示了当前主流FOC控制器的技术对比：

表1-1 主流FOC控制器技术对比

| 控制器类型 | 典型产品 | 处理能力 | 浮点运算 | 成本(USD) | 主要应用领域 |
|-----------|---------|---------|---------|----------|-------------|
| DSP控制器 | TI TMS320F28335 | 150MHz | 硬件支持 | 15-25 | 工业伺服 |
| ARM Cortex-M | STM32F4系列 | 168MHz | 硬件支持 | 8-15 | 消费电子 |
| FPGA方案 | Xilinx Spartan | 可配置 | 硬件支持 | 30-50 | 高端应用 |
| ESP32方案 | ESP32-WROOM | 240MHz | 软件模拟 | 3-8 | 物联网 |

从表中可以看出，ESP32在成本优势方面表现突出，其双核架构和较高的主频为实现复杂的FOC算法提供了可能。

### 1.2.2 国内研究现状

国内在FOC控制技术方面也取得了显著进展，特别是在永磁同步电机(PMSM)控制领域。许多高校和研究机构开展了相关研究工作，主要集中在算法优化和硬件实现两个方向。

## 1.3 FOC控制基本原理

FOC控制的核心思想是通过坐标变换将三相交流电机的控制问题转化为类似直流电机的控制问题。其基本数学模型如下：

### 1.3.1 Park变换

Park变换是FOC控制的基础，其实现公式为：

$$\begin{bmatrix} i_d \\ i_q \\ i_0 \end{bmatrix} = \frac{2}{3}\begin{bmatrix} \cos\theta & \cos(\theta-\frac{2\pi}{3}) & \cos(\theta+\frac{2\pi}{3}) \\ -\sin\theta & -\sin(\theta-\frac{2\pi}{3}) & -\sin(\theta+\frac{2\pi}{3}) \\ \frac{1}{2} & \frac{1}{2} & \frac{1}{2} \end{bmatrix} \begin{bmatrix} i_a \\ i_b \\ i_c \end{bmatrix}$$

其中：$i_d$、$i_q$分别为直轴和交轴电流分量，$\theta$为转子电角度。

### 1.3.2 电压方程

在dq坐标系下，PMSM的电压方程可表示为：

$$\begin{cases}u_d = R_s i_d + L_d \frac{di_d}{dt} - \omega_e L_q i_q \\ u_q = R_s i_q + L_q \frac{di_q}{dt} + \omega_e L_d i_d + \omega_e \psi_f \end{cases}$$

式中各参数含义：
- $u_d$, $u_q$：dq轴电压分量
- $R_s$：定子电阻
- $L_d$, $L_q$：dq轴电感
- $\omega_e$：电角速度
- $\psi_f$：永磁体磁链

## 1.4 系统总体设计方案

基于ESP32的FOC控制系统整体架构如图1-1所示：

```
┌─────────────────┐    ┌───────────────┐    ┌─────────────────┐
│   电流检测      │───▶│               │───▶│   PWM驱动电路   │
│   位置检测      │    │    ESP32     │    │                 │
│   电压检测      │◀───│   微控制器    │◀───│   逆变器电路    │
└─────────────────┘    └───────────────┘    └─────────────────┘
                            │     ▲
                            │     │
                            ▼     │
                      ┌───────────────┐
                      │   上位机监控  │
                      │   (WiFi通信)  │
                      └───────────────┘
```

图1-1 系统整体架构图

### 1.4.1 硬件平台选择

本设计选用ESP32-WROOM-32D模组作为主控芯片，其主要技术参数如表1-2所示：

表1-2 ESP32技术参数

| 参数项 | 规格 |
|-------|------|
| CPU架构 | Xtensa LX6双核 |
| 主频 | 240MHz |
| SRAM | 520KB |
| Flash | 4MB |
| ADC通道 | 18路(12位) |
| PWM通道 | 16路 |
| 通信接口 | UART/SPI/I2C/CAN |

### 1.4.2 控制算法流程

FOC控制算法的基本执行流程如下：

1. **数据采集阶段**
   - 采集三相电流信号 $i_a$, $i_b$, $i_c$
   - 获取转子位置信息 $\theta$
   - 读取给定转速指令 $\omega^*$

2. **坐标变换阶段**
   - Clarke变换：$i_\alpha$, $i_\beta$ = Clarke($i_a$, $i_b$, $i_c$)
   - Park变换：$i_d$, $i_q$ = Park($i_\alpha$, $i_\beta$, $\theta$)

3. **控制计算阶段**
   - 速度环PI调节：$\omega_e^*$ = PI($\omega^*$ - $\omega$)
   - 电流环PI调节：$u_d^*$, $u_q^*$ = PI($i_d^*$ - $i_d$, $i_q^*$ - $i_q$)

4. **反变换阶段**
   - 反Park变换：$u_\alpha^*$, $u_\beta^*$ = Park^{-1}($u_d^*$, $u_q^*$, $\theta$)
   - SVPWM调制：生成PWM占空比信号

## 1.5 本文主要研究内容

本文围绕基于ESP32的FOC控制器设计展开深入研究，主要工作包括：

1. **理论分析与建模**
   - 建立PMSM数学模型
   - 分析FOC控制原理和实现方法
   - 研究坐标变换算法的数字化实现

2. **硬件系统设计**
   - 设计功率驱动电路
   - 构建电流电压检测电路
   - 实现位置传感器接口电路

3. **软件算法实现**
   - 移植和优化FOC控制算法
   - 实现SVPWM波形生成
   - 设计多任务调度机制

4. **系统测试与验证**
   - 搭建实验测试平台
   - 进行动静态性能测试
   - 分析系统稳定性和控制精度

通过以上研究工作，旨在开发一套成本低廉、性能优良的智能FOC控制系统，为中小型电机控制应用提供有效的解决方案。